// src/repository/user.repository.test.ts
import {  DataSource } from 'typeorm';
import { User } from '../src/entities/User.entity';
import { startTestDatabase, stopTestDatabase, getDataSource, connectDb } from './MongoAppTestContainer';
import { UserRepository } from '../src/repositories/UserRepository.repository';


describe('UserRepository', () => {
        jest.setTimeout(60000);

    let dataSource: DataSource;
    let userRepository: UserRepository;;

    beforeAll(async () => {
        dataSource = await startTestDatabase();

        userRepository = new UserRepository(dataSource);
    });

    afterAll(async () => {
        await stopTestDatabase();
    });

    beforeEach(async () => {
        // Clear the collection before each test to ensure test isolation
        await userRepository.clear(); 
    });

    it('should save a user to the database', async () => {
        const user = new User();
        user.name = 'John';
        user.email = 'john@gmail.com';

        await userRepository.save(user);

        const savedUser = await userRepository.findOneBy({ name: 'John' });
        expect(savedUser).toBeDefined();
        expect(savedUser?.name).toBe('John');
    },10000);
});
